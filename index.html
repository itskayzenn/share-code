<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kayzen ShareCode</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --accent:#38bdf8;
}
body{
  margin:0;
  font-family:Inter, sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
}
nav{
  display:flex;
  justify-content:space-between;
  padding:20px;
  backdrop-filter:blur(10px);
  background:rgba(30,41,59,.6);
}
nav a{
  color:white;
  text-decoration:none;
  margin:0 10px;
}
.container{padding:40px;max-width:1000px;margin:auto;}
.card{
  background:rgba(30,41,59,.7);
  padding:20px;
  border-radius:15px;
  margin:15px 0;
  backdrop-filter:blur(12px);
}
.profile{
  width:160px;height:160px;border-radius:50%;
  border:4px solid var(--accent);object-fit:cover;
}
input,textarea{
  width:100%;padding:12px;margin:8px 0;
  border:none;border-radius:10px;background:#0f172a;color:white;
}
button{
  padding:10px 15px;border:none;border-radius:8px;
  background:var(--accent);color:black;cursor:pointer;
}
pre{border-radius:10px;}
.dropzone{
  border:2px dashed var(--accent);
  padding:30px;text-align:center;border-radius:15px;
}
</style>
</head>
<body>

<nav>
  <div><b>Kayzen ShareCode</b></div>
  <div>
    <a href="#home">Home</a>
    <a href="#snippets">Snippets</a>
    <a href="#admin">Admin</a>
    <a href="#request">Request</a>
    <a href="#contact">Contact</a>
  </div>
</nav>

<div class="container" id="app"></div>

<script>
const supabase = window.supabase.createClient(
  "YOUR_SUPABASE_URL",
  "YOUR_SUPABASE_ANON_KEY"
);

let isAdmin=false;

function router(){
  const h=location.hash||"#home";
  if(h.startsWith("#raw/")) return raw(h.split("/")[1]);
  if(h=="#home") home();
  if(h=="#snippets") snippets();
  if(h=="#admin") admin();
  if(h=="#request") requestPage();
  if(h=="#contact") contact();
}
window.onhashchange=router;router();

function home(){
app.innerHTML=`
<center>
<img src="https://i.ibb.co.com/wrrLvKCP/image.jpg" class="profile"/>
<h1>Kayzen Izumi</h1>
<p>Fullstack Developer • Bot Automation • Scraping Expert</p>
</center>

<div class="card">
<h3>About Me</h3>
<p>Saya developer fokus automation & bot WhatsApp/Telegram.</p>
</div>

<div class="card">
<h3>Skills</h3>
JavaScript • NodeJS • Supabase • API • Web Scraping
</div>`;
}

async function snippets(){
const {data}=await supabase.from("snippets").select("*").order("id",{ascending:false});
let html=`<h2>Snippets</h2>
<input placeholder="Search..." oninput="searchSnippet(this.value)"/>`;
data.forEach(s=>{
html+=`
<div class="card">
<h3>${s.title}</h3>
<p>${s.description||''}</p>
<button onclick="viewSnippet(${s.id})">View</button>
<button onclick="copyCode(\`${s.code}\`)">Copy</button>
${isAdmin?`<button onclick="editSnippet(${s.id})">Edit</button>
<button onclick="deleteSnippet(${s.id})">Delete</button>`:''}
<a href="/raw/${s.title}" target="_blank">Raw</a>
</div>`;
});
app.innerHTML=html;
}

async function viewSnippet(id){
const {data}=await supabase.from("snippets").select("*").eq("id",id).single();
app.innerHTML=`
<h2>${data.title}</h2>
<pre><code class="language-${data.language}">${escape(data.code)}</code></pre>
<button onclick="location.hash='#snippets'">Back</button>`;
Prism.highlightAll();
}

function copyCode(t){navigator.clipboard.writeText(t);alert("Copied!");}

async function deleteSnippet(id){
await supabase.from("snippets").delete().eq("id",id);
snippets();
}

function admin(){
if(!isAdmin){
app.innerHTML=`
<h2>Admin Login</h2>
<input type="password" id="pass"/>
<button onclick="login()">Login</button>`;
}else{
app.innerHTML=`
<h2>Upload Snippet</h2>
<div class="dropzone" id="drop">Drop file here (max 10)</div>
<input id="title" placeholder="Title"/>
<textarea id="desc" placeholder="Description"></textarea>
<textarea id="code" placeholder="Code"></textarea>
<button onclick="upload()">Upload</button>`;
initDrop();
}
}

async function login(){
const r=await fetch("/api/admin-login",{method:"POST",body:JSON.stringify({password:pass.value})});
const d=await r.json();
if(d.success){isAdmin=true;admin();}
else alert("Wrong password");
}

async function upload(){
await supabase.from("snippets").insert({
title:title.value,
description:desc.value,
code:code.value,
language:detectLang(title.value)
});
alert("Uploaded");
}

function detectLang(name){
if(name.endsWith(".js")) return "javascript";
if(name.endsWith(".html")) return "markup";
if(name.endsWith(".css")) return "css";
return "text";
}

function initDrop(){
const dz=document.getElementById("drop");
dz.ondrop=e=>{
e.preventDefault();
const files=e.dataTransfer.files;
if(files.length>10) return alert("Max 10 file");
[...files].forEach(f=>{
const reader=new FileReader();
reader.onload=()=>{code.value=reader.result;title.value=f.name;}
reader.readAsText(f);
});
};
dz.ondragover=e=>e.preventDefault();
}

async function raw(title){
const {data}=await supabase.from("snippets").select("*").eq("title",title).single();
document.body.innerText=data.code;
}

function contact(){
app.innerHTML=`
<h2>Contact</h2>
<div class="card">
WhatsApp: 628152313006<br>
Telegram: nonewpo<br>
YouTube: kayzenfry<br>
GitHub: Kayzen-dev-tech<br>
Instagram: kayzenfry<br>
TikTok: sczkayzen<br>
Twitter/X: kayzenfry<br>
Email: kayzz.my@gmail.com / kayzenfry@gmail.com
</div>`;
}

function requestPage(){
app.innerHTML=`
<h2>Request Scrape & Feature Bot WhatsApp/Telegram</h2>
<input id="nama" placeholder="Nama (wajib)"/>
<input id="url" placeholder="https://contoh.com"/>
<textarea id="deskripsi" placeholder="Deskripsi"></textarea>
<button onclick="sendReq()">Send</button>`;
}

async function sendReq(){
await fetch("/api/request",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
nama:nama.value,
url:url.value,
deskripsi:deskripsi.value
})
});
alert("Request sent");
}

function escape(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;");}
</script>
</body>
</html>