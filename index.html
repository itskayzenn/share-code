<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayzen Izumi | Code Snippets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; color: white; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .nav-link.active { color: #38bdf8; border-bottom: 2px solid #38bdf8; }
        #raw-container { display: none; background: white; color: black; min-height: 100vh; padding: 20px; font-family: monospace; white-space: pre; }
    </style>
</head>
<body>

<div id="raw-container"></div>

<div id="main-app">
    <nav class="sticky top-0 z-50 glass px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <img src="https://i.ibb.co.com/wrrLvKCP/image.jpg" class="w-10 h-10 rounded-full border-2 border-sky-500 shadow-lg shadow-sky-500/20">
            <span class="font-bold text-xl tracking-tight">Kayzen<span class="text-sky-400">Izumi</span></span>
        </div>
        <div class="hidden md:flex gap-6 font-medium">
            <button onclick="showPage('home')" class="nav-link hover:text-sky-400 transition">Home</button>
            <button onclick="showPage('snippets')" class="nav-link hover:text-sky-400 transition">Snippets</button>
            <button onclick="showPage('request')" class="nav-link hover:text-sky-400 transition">Request</button>
            <button onclick="showPage('contact')" class="nav-link hover:text-sky-400 transition">Contact</button>
            <button onclick="showPage('admin')" class="bg-sky-600 px-4 py-1 rounded-full text-sm hover:bg-sky-500 transition">Admin</button>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-6">
        
        <section id="page-home" class="page-content py-10 animate-fade-in">
            <div class="text-center mb-16">
                <img src="https://i.ibb.co.com/wrrLvKCP/image.jpg" class="w-32 h-32 rounded-full mx-auto border-4 border-sky-500 mb-6 shadow-2xl">
                <h1 class="text-4xl font-extrabold mb-2">Kayzen Izumi</h1>
                <p class="text-slate-400 max-w-lg mx-auto">Fullstack Developer & Automation Enthusiast. Fokus pada pengembangan bot WhatsApp/Telegram dan optimasi workflow.</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-xl font-bold mb-4 text-sky-400"><i class="fas fa-code mr-2"></i> Skillset</h3>
                    <div class="flex flex-wrap gap-2">
                        <span class="bg-slate-800 px-3 py-1 rounded-lg text-sm border border-slate-700">JavaScript (Node.js)</span>
                        <span class="bg-slate-800 px-3 py-1 rounded-lg text-sm border border-slate-700">Python Scraper</span>
                        <span class="bg-slate-800 px-3 py-1 rounded-lg text-sm border border-slate-700">Next.js</span>
                        <span class="bg-slate-800 px-3 py-1 rounded-lg text-sm border border-slate-700">Supabase</span>
                    </div>
                </div>
                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-xl font-bold mb-4 text-sky-400"><i class="fas fa-rocket mr-2"></i> Current Projects</h3>
                    <ul class="text-slate-300 space-y-2">
                        <li>â€¢ WhatsApp Multi-Device Automation</li>
                        <li>â€¢ Web Scraper Dashboard</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="page-snippets" class="page-content hidden py-10">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <h2 class="text-3xl font-bold">Code Snippets</h2>
                <div class="relative w-full md:w-64">
                    <input type="text" id="search-input" oninput="searchSnippets()" placeholder="Search code..." class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-sky-500 outline-none">
                </div>
            </div>
            <div id="snippets-list" class="grid gap-6">
                <p class="text-center text-slate-500">Loading snippets...</p>
            </div>
        </section>

        <section id="page-request" class="page-content hidden py-10">
            <div class="max-w-xl mx-auto glass p-8 rounded-2xl">
                <h2 class="text-2xl font-bold mb-6">Request Scrape & Feature</h2>
                <form id="request-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Nama *</label>
                        <input type="text" id="req-nama" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">URL (https://contoh.com) *</label>
                        <input type="url" id="req-url" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Deskripsi *</label>
                        <textarea id="req-desc" required placeholder="scrape [topic] ini, hanya bagian [yang diminta]" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 outline-none h-32"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-sky-600 hover:bg-sky-500 py-3 rounded-xl font-bold transition">Kirim Request</button>
                </form>
            </div>
        </section>

        <section id="page-contact" class="page-content hidden py-10">
            <h2 class="text-3xl font-bold mb-8 text-center">Get In Touch</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="https://wa.me/628152313006" class="glass p-6 rounded-2xl flex flex-col items-center hover:bg-sky-500/10 transition">
                    <i class="fab fa-whatsapp text-3xl text-green-500 mb-3"></i>
                    <span>WhatsApp</span>
                </a>
                <a href="https://t.me/nonewpo" class="glass p-6 rounded-2xl flex flex-col items-center hover:bg-sky-500/10 transition">
                    <i class="fab fa-telegram text-3xl text-sky-400 mb-3"></i>
                    <span>Telegram</span>
                </a>
                <a href="https://github.com/Kayzen-dev-tech" class="glass p-6 rounded-2xl flex flex-col items-center hover:bg-sky-500/10 transition">
                    <i class="fab fa-github text-3xl mb-3"></i>
                    <span>GitHub</span>
                </a>
                <a href="mailto:kayzz.my@gmail.com" class="glass p-6 rounded-2xl flex flex-col items-center hover:bg-sky-500/10 transition">
                    <i class="fas fa-envelope text-3xl text-red-400 mb-3"></i>
                    <span>Email</span>
                </a>
                </div>
        </section>

        <section id="page-admin" class="page-content hidden py-10">
            <div id="admin-login" class="max-w-sm mx-auto glass p-8 rounded-2xl">
                <h2 class="text-2xl font-bold mb-6 text-center">Admin Access</h2>
                <input type="password" id="admin-pass" placeholder="Password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 mb-4 outline-none">
                <button onclick="handleAdminLogin()" class="w-full bg-sky-600 py-2 rounded-lg font-bold">Login</button>
            </div>

            <div id="admin-panel" class="hidden space-y-8">
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-2xl font-bold mb-4">Upload Code</h2>
                    <div id="drop-zone" class="border-2 border-dashed border-slate-700 rounded-2xl p-10 text-center hover:border-sky-500 transition cursor-pointer mb-4">
                        <i class="fas fa-cloud-upload-alt text-4xl text-slate-500 mb-3"></i>
                        <p>Drag & Drop files here or click to upload (Max 10 files)</p>
                        <input type="file" id="file-input" multiple class="hidden">
                    </div>
                    <div id="file-queue" class="space-y-2 mb-4"></div>
                    <button id="btn-publish" class="bg-green-600 px-6 py-2 rounded-lg font-bold">Publish All</button>
                    <button onclick="logout()" class="text-slate-500 ml-4">Logout</button>
                </div>
            </div>
        </section>

    </main>
</div>

<script>
    // CONFIGURATION (Disediakan via user)
    const CONFIG = {
        SUPABASE_URL: 'https://xcugdkmkloosooyzwyte.supabase.co',
        SUPABASE_ANON_KEY: 'sb_publishable_tFSi6uQth6ZMyUIduLjkpA_5r0JbE2m',
        TELEGRAM_BOT_TOKEN_REQUEST: '8455571859:AAFzJU3hS0iv7mVVh6sZEj0LlzU0237Kuqk',
        TELEGRAM_BOT_TOKEN_LOGIN: '8415064497:AAGprLIhNq45Kr6m-QNu5ZFcpcWvvlRWYuk',
        TELEGRAM_CHAT_ID: '6442476342',
        ADMIN_PASSWORD: 'kayzenganteng'
    };

    const supabase = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
    let isAdmin = false;

    // --- LOGIKA ROUTING RAW ---
    const urlParams = new URLSearchParams(window.location.search);
    const rawId = urlParams.get('raw');
    if(rawId) {
        document.getElementById('main-app').style.display = 'none';
        const rawContainer = document.getElementById('raw-container');
        rawContainer.style.display = 'block';
        fetchRaw(rawId);
    }

    async function fetchRaw(id) {
        const { data } = await supabase.from('snippets').select('code').eq('id', id).single();
        document.getElementById('raw-container').textContent = data ? data.code : 'Snippet not found.';
    }

    // --- LOGIKA DASHBOARD ---
    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
        document.getElementById(`page-${pageId}`).classList.remove('hidden');
        if(pageId === 'snippets') fetchSnippets();
    }

    async function fetchSnippets() {
        const { data, error } = await supabase.from('snippets').select('*').order('created_at', { ascending: false });
        renderSnippets(data || []);
    }

    function renderSnippets(data) {
        const list = document.getElementById('snippets-list');
        list.innerHTML = data.map(item => `
            <div class="glass p-6 rounded-2xl">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-xl font-bold">${item.title}</h3>
                        <span class="text-xs text-sky-400 uppercase tracking-widest">${item.language}</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copyToClipboard(\`${item.code.replace(/`/g, '\\`')}\`)" class="p-2 hover:text-sky-400"><i class="fas fa-copy"></i></button>
                        <a href="?raw=${item.id}" target="_blank" class="p-2 hover:text-sky-400"><i class="fas fa-external-link-alt"></i></a>
                        ${isAdmin ? `
                            <button onclick="deleteSnippet(${item.id})" class="p-2 hover:text-red-500"><i class="fas fa-trash"></i></button>
                        ` : ''}
                    </div>
                </div>
                <pre class="bg-slate-900 p-4 rounded-xl overflow-x-auto text-sm border border-slate-800"><code>${escapeHtml(item.code.substring(0, 200))}${item.code.length > 200 ? '...' : ''}</code></pre>
            </div>
        `).join('');
    }

    // --- LOGIKA ADMIN & UPLOAD ---
    async function handleAdminLogin() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === CONFIG.ADMIN_PASSWORD) {
            isAdmin = true;
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            
            // Notify Telegram Login
            sendTelegram(CONFIG.TELEGRAM_BOT_TOKEN_LOGIN, `ðŸ”‘ *Admin Login Detected*\nTime: ${new Date().toLocaleString()}`);
        } else {
            alert('Wrong password!');
        }
    }

    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    let uploadedFiles = [];

    dropZone.onclick = () => fileInput.click();
    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-sky-500'); };
    dropZone.ondragleave = () => dropZone.classList.remove('border-sky-500');
    dropZone.ondrop = (e) => {
        e.preventDefault();
        handleFiles(e.dataTransfer.files);
    };
    fileInput.onchange = (e) => handleFiles(e.target.files);

    function handleFiles(files) {
        const fileList = Array.from(files).slice(0, 10);
        fileList.forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedFiles.push({ title: file.name, code: e.target.result, language: file.name.split('.').pop() });
                updateQueueUI();
            };
            reader.readAsText(file);
        });
    }

    function updateQueueUI() {
        document.getElementById('file-queue').innerHTML = uploadedFiles.map((f, i) => `
            <div class="flex justify-between bg-slate-800 p-2 rounded-lg text-sm">
                <span>${f.title}</span>
                <button onclick="uploadedFiles.splice(${i},1);updateQueueUI()" class="text-red-400">Remove</button>
            </div>
        `).join('');
    }

    document.getElementById('btn-publish').onclick = async () => {
        if(uploadedFiles.length === 0) return;
        const { error } = await supabase.from('snippets').insert(uploadedFiles);
        if(!error) {
            alert('Published successfully!');
            uploadedFiles = [];
            updateQueueUI();
            fetchSnippets();
        }
    };

    // --- LOGIKA REQUEST ---
    document.getElementById('request-form').onsubmit = async (e) => {
        e.preventDefault();
        const nama = document.getElementById('req-nama').value;
        const url = document.getElementById('req-url').value;
        const desc = document.getElementById('req-desc').value;

        const message = `ðŸ“© *Request Scrape & Feature*\n\n*Nama:* ${nama}\n*URL:* ${url}\n*Deskripsi:* ${desc}\n\n*Waktu:* ${new Date().toLocaleString()}`;
        
        const success = await sendTelegram(CONFIG.TELEGRAM_BOT_TOKEN_REQUEST, message);
        if(success) {
            alert('Request sent!');
            e.target.reset();
        }
    };

    // --- HELPERS ---
    async function sendTelegram(token, text) {
        const url = `https://api.telegram.org/bot${token}/sendMessage`;
        const res = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ chat_id: CONFIG.TELEGRAM_CHAT_ID, text: text, parse_mode: 'Markdown' })
        });
        return res.ok;
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        alert('Copied to clipboard!');
    }

    function escapeHtml(text) {
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }

    function searchSnippets() {
        const term = document.getElementById('search-input').value.toLowerCase();
        document.querySelectorAll('#snippets-list > div').forEach(card => {
            const title = card.querySelector('h3').innerText.toLowerCase();
            card.style.display = title.includes(term) ? 'block' : 'none';
        });
    }
</script>
</body>
</html>
